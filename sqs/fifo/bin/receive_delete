#!/usr/bin/bash

echo "== receive message"

QUEUE_URL="https://sqs.ca-central-1.amazonaws.com/169634835787/eth-sqs-fifo-EthQueue-zKEzSAK91HJY.fifo"

RESULT=$(aws sqs receive-message \
--queue-url $QUEUE_URL \
--attribute-names All \
--message-attribute-names All \
--max-number-of-messages 10)


echo "$RESULT" | jq -r '.Messages[].ReceiptHandle' | while read -r RECEIPT_HANDLE; do
  echo "Deleting Receipt: $RECEIPT_HANDLE"
  aws sqs delete-message \
    --queue-url "$QUEUE_URL" \
    --receipt-handle "$RECEIPT_HANDLE"
done